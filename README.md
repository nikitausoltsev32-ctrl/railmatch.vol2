# RailMatch Vol. 2

Логистическая платформа, соединяющая грузоотправителей и перевозчиков для железнодорожных перевозок, построенная на Supabase и современных веб-технологиях.

## Обзор

RailMatch - это B2B платформа, которая способствует соединению компаний, нуждающихся в перевозке грузов по железной дороге (грузоотправители), с поставщиками железнодорожных перевозок (перевозчики). Платформа позволяет грузоотправителям размещать заявки на перевозку грузов, а перевозчикам - подавать конкурентные предложения.

## Технологический стек

- **База данных**: Supabase (PostgreSQL с возможностями реального времени)
- **Бэкенд**: Supabase (Аутентификация, База данных, Хранилище)
- **Фронтенд**: Next.js 16 с TypeScript
- **Язык**: TypeScript
- **Стили**: Tailwind CSS 4
- **Иконки**: Lucide React
- **Форматирование**: ESLint & Prettier

## Структура базы данных

### Основные таблицы

#### `profiles`
Пользовательские профили с контролем доступа на основе ролей.
- **Колонки**: `id`, `email`, `full_name`, `role`, `company_name`, `phone`, временные метки
- **Роли**: `shipper` (Заказчик), `carrier` (Исполнитель), `admin`
- **Доступ**: Пользователи могут просматривать/редактировать только свой профиль; администраторы могут просматривать все

#### `requests`
Заявки на перевозку грузов, размещаемые грузоотправителями.
- **Колонки**: `id`, `shipper_id`, `route_from`, `route_to`, `cargo_description`, `cargo_weight`, `wagon_type`, `wagon_count`, `loading_date`, `unloading_date`, `target_price`, `status`, `additional_requirements`, временные метки
- **Статусы**: `open`, `in_progress`, `completed`, `cancelled`
- **Доступ**: Публичный доступ на чтение, грузоотправители могут создавать/обновлять свои заявки

#### `bids`
Конкурентные предложения, подаваемые перевозчиками на конкретные заявки.
- **Колонки**: `id`, `request_id`, `owner_id`, `amount`, `notes`, `status`, `valid_until`, временные метки
- **Статусы**: `pending`, `accepted`, `rejected`, `withdrawn`
- **Доступ**: Пользователи могут видеть свои предложения и предложения на своих заявках; перевозчики могут создавать предложения, грузоотправители могут принимать/отклонять

#### `messages`
Общение между пользователями, связанное с предложениями и заявками.
- **Колонки**: `id`, `bid_id`, `request_id`, `sender_id`, `body`, `read_at`, временные метки
- **Доступ**: Пользователи могут видеть только сообщения, которые они отправили или получили (участники предложений или владелец заявки)

## Начало работы

### Предварительные требования

- Node.js 18+ и npm/yarn
- Аккаунт Supabase и проект
- Git

### Установка

1. **Клонирование репозитория**
   ```bash
   git clone <repository-url>
   cd railmatch.vol2
   ```

2. **Установка зависимостей**
   ```bash
   npm install
   ```

3. **Настройка переменных окружения**
   ```bash
   cp .env.example .env.local
   ```
   Обновите `.env.local` с вашими учетными данными проекта Supabase:
   - `NEXT_PUBLIC_SUPABASE_URL`: URL вашего проекта Supabase
   - `NEXT_PUBLIC_SUPABASE_ANON_KEY`: Ваш анонимный ключ Supabase

4. **Настройка базы данных**
   
   Если вы начинаете с нуля:
   ```bash
   # Отправить начальную схему в ваш проект Supabase
   npm run db:push
   ```
   
   Или если вам нужно сбросить:
   ```bash
   npm run db:reset
   ```

5. **Генерация TypeScript типов**
   ```bash
   npm run db:generate-types
   ```

### Разработка

```bash
# Запустить сервер разработки
npm run dev

# Проверка типов
npm run type-check

# Линтинг
npm run lint
```

## Управление базой данных

### Команды миграции

```bash
# Отправить локальные изменения в удаленную базу данных
npm run db:push

# Сбросить базу данных для соответствия локальной схеме
npm run db:reset

# Показать различия между локальной и удаленной
npm run db:diff

# Сгенерировать TypeScript типы из схемы базы данных
npm run db:generate-types
```

### Изменения схемы

1. Создайте новые файлы миграции в `supabase/migrations/`
2. Используйте соглашение об именовании с временной меткой: `YYYYMMDDHHMMSS_description.sql`
3. Протестируйте локально с `npm run db:diff`
4. Примените изменения с `npm run db:push`

## Структура проекта

```
railmatch.vol2/
├── app/
│   ├── auth/                 # Страницы аутентификации
│   ├── dashboard/            # Защищенные дашборды
│   ├── layout.tsx           # Корневой layout
│   ├── page.tsx             # Главная страница
│   └── globals.css          # Глобальные стили
├── components/
│   ├── auth/                # Компоненты аутентификации
│   ├── ui/                  # Базовые UI компоненты
│   ├── Navigation.tsx       # Навигация
│   ├── Hero.tsx            # Hero секция
│   └── Footer.tsx          # Footer
├── lib/
│   ├── supabase.ts          # Supabase клиент и типы
│   ├── auth.ts              # Хелперы аутентификации
│   └── database.types.ts    # Сгенерированные TypeScript типы
├── supabase/
│   ├── migrations/          # Файлы миграций базы данных
│   └── config.json          # Конфигурация Supabase
├── middleware.ts            # Middleware для защиты маршрутов
└── .env.example             # Шаблон переменных окружения
```

## Ключевые функции

### Для Грузоотправителей (Заказчиков)
- Размещение заявок на перевозку грузов с детальными спецификациями
- Просмотр и сравнение конкурентных предложений от перевозчиков
- Прямая коммуникация с перевозчиками через сообщения
- Отслеживание статуса заявки от открытой до завершенной

### для Перевозчиков (Исполнителей)
- Просмотр доступных заявок на перевозку грузов в реальном времени
- Подача конкурентных предложений с детальными предложениями
- Общение с грузоотправителями для уточнения требований
- Управление статусом предложений и отслеживание принятых контрактов

### для Администраторов Платформы
- Управление пользователями и назначение ролей
- Мониторинг активности платформы и транзакций
- Разрешение споров и предоставление поддержки
- Доступ к комплексной аналитике и отчетности

## Соображения безопасности

- **Row Level Security**: Весь доступ к базе данных контролируется политиками RLS
- **Аутентификация**: Supabase Auth безопасно обрабатывает аутентификацию пользователей
- **Валидация входных данных**: Ограничения базы данных и валидация на уровне приложения
- **Конфиденциальность**: Приватные данные (предложения, сообщения) доступны только авторизованным участникам
- **Аудит**: Автоматические временные метки отслеживают все изменения данных